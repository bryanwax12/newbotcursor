# ‚úÖ PERSISTENCE –î–û–ë–ê–í–õ–ï–ù –î–õ–Ø CONVERSATIONHANDLER

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

–î–æ–±–∞–≤–ª–µ–Ω–∞ **PicklePersistence** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ConversationHandler –≤ —Ñ–∞–π–ª.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:

**–§–∞–π–ª:** `/app/backend/server.py`

```python
from telegram.ext import PicklePersistence, PersistenceInput

# Persistence —Ñ–∞–π–ª: /app/backend/data/conversation_state.pkl
persistence = PicklePersistence(
    filepath='/app/backend/data/conversation_state.pkl',
    store_data=PersistenceInput(
        user_data=True,      # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        chat_data=True,      # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–∞—Ç–∞
        bot_data=True,       # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞
        callback_data=True   # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç callback data
    ),
    update_interval=1  # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
)

Application.builder().persistence(persistence).build()
```

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞:
```
/app/backend/data/
```

---

## –ö–∞–∫ —ç—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:

**–î–û (–±–µ–∑ persistence):**
- State –≤ –ø–∞–º—è—Ç–∏ ‚Üí —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí timeout ‚Üí state –ø–æ—Ç–µ—Ä—è–Ω
- –ù—É–∂–µ–Ω –≤—Ç–æ—Ä–æ–π –≤–≤–æ–¥ ‚Üí state —Å–æ–∑–¥–∞–Ω –∑–∞–Ω–æ–≤–æ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü–û–°–õ–ï (—Å persistence):**
- State —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- –î–∞–∂–µ –ø—Ä–∏ timeout state –ù–ï —Ç–µ—Ä—è–µ—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí state —Å–æ—Ö—Ä–∞–Ω—ë–Ω
- –°–ª–µ–¥—É—é—â–∏–π –≤–≤–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ state
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞!

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. ‚úÖ **–ù–µ —Ç–µ—Ä—è–µ—Ç—Å—è state** –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
2. ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º–∏** backend
3. ‚úÖ **–ë—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
4. ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ deployed –≤–µ—Ä—Å–∏–∏**
5. ‚úÖ **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** (–Ω–µ –Ω—É–∂–µ–Ω upgrade MongoDB)

---

## –ü–æ—Å–ª–µ Redeploy:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –≤–≤–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ **–° –ü–ï–†–í–û–ì–û –†–ê–ó–ê**!

–§–∞–π–ª `/app/backend/data/conversation_state.pkl` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–æ—Ç–∞.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ü–æ—Å–ª–µ redeploy –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞—á–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
3. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (–∏–º—è, –∞–¥—Ä–µ—Å –∏ —Ç.–¥.)
4. ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ü–ï–†–í–û–ì–û –†–ê–ó–ê (–Ω–µ –Ω—É–∂–µ–Ω –≤—Ç–æ—Ä–æ–π –≤–≤–æ–¥!)

---

**Persistence –≥–æ—Ç–æ–≤ –∫ deployment!** üöÄ
