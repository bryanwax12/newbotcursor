# üìã –°–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (P0)

### ‚úÖ Issue 1: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–®–ï–ù–û
- **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**: 
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–æ—Å—Ç—É–ø –∫ bot_instance —á–µ—Ä–µ–∑ app.state
  - –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∏ —É–∫–æ—Ä–æ—á–µ–Ω—ã
  - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: 5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ

---

## üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (P1)

### ‚ö†Ô∏è Issue 2: Oxapay webhooks –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–°—Ç–∞—Ç—É—Å**: –ë–õ–û–ö–ò–†–û–í–ê–ù–û (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**:
  - ‚úÖ –°–µ—Ä–≤–µ—Ä–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - ‚úÖ bot_instance –¥–æ—Å—Ç—É–ø–µ–Ω (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- **–¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
  - –ó–∞–π—Ç–∏ –≤ Oxapay –∞–∫–∫–∞—É–Ω—Ç
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Callback URL: `{preview_url}/api/oxapay/webhook`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –≤ Oxapay

### üêõ BUG: bot_instance –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ 19 —Ä–æ—É—Ç–µ—Ä–∞—Ö
- **–°—Ç–∞—Ç—É—Å**: –¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç `from server import bot_instance` –Ω–∞–ø—Ä—è–º—É—é
- **–§–∞–π–ª—ã —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
  - `/app/backend/routers/admin/users.py` (2 –º–µ—Å—Ç–∞)
  - `/app/backend/routers/admin_router.py` (4 –º–µ—Å—Ç–∞)
  - `/app/backend/routers/broadcast.py`
  - `/app/backend/routers/bot.py` (2 –º–µ—Å—Ç–∞)
  - `/app/backend/routers/bot_config_router.py` (3 –º–µ—Å—Ç–∞)
  - `/app/backend/routers/refunds.py`
  - `/app/backend/routers/legacy_api.py` (3 –º–µ—Å—Ç–∞)
  - `/app/backend/routers/users.py` (2 –º–µ—Å—Ç–∞)
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `request.app.state.bot_instance`

---

## üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (P2)

### Issue 3: –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- **–°—Ç–∞—Ç—É—Å**: –û–ñ–ò–î–ê–ï–¢ –ü–†–û–í–ï–†–ö–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ú
- **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**: 
  - ‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (legacy endpoints —Å–æ–∑–¥–∞–Ω—ã)
  - ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ API (–≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- **–¢—Ä–µ–±—É–µ—Ç—Å—è**: 
  - –ó–∞–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–Ω–æ–ø–∫–∏: Details, Add/Deduct Balance, Block/Unblock

### üîß –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (logger.info –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è)
- **–°—Ç–∞—Ç—É—Å**: –ß–ê–°–¢–ò–ß–ù–û –†–ï–®–ï–ù–û (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è print())
- **–ü—Ä–æ–±–ª–µ–º–∞**: 
  - –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é WARNING
  - `logger.info()` –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ stdout
  - –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `print()` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**:
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å logging.basicConfig –≤ server.py
  - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å INFO –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞
  - –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `print()` –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ `logger.info()`

---

## üü¢ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (P3)

### Issue 4: –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- **–°—Ç–∞—Ç—É—Å**: –ù–ï –ù–ê–ß–ê–¢–û
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –ò–∑—É—á–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±–æ—Ç–æ–≤
  - –ù–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É, –ø–æ—á–µ–º—É —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
  - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

---

## üîµ –ü–†–ï–î–°–¢–û–Ø–©–ò–ï –ó–ê–î–ê–ß–ò (Upcoming)

### 1. –ü–æ–ª–Ω—ã–π –ª–∏–Ω—Ç–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞
- **–ö–æ–º–∞–Ω–¥–∞**: `ruff check --fix /app/backend/`
- **–¶–µ–ª—å**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ª–∏–Ω—Ç–µ—Ä–∞

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Production Environment
- **–ó–∞–¥–∞—á–∏**:
  - ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ .env –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook —Ä–µ–∂–∏–º (–≤–º–µ—Å—Ç–æ polling)
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—á–∏—Å—Ç–∫–∞
- **–ó–∞–¥–∞—á–∏**:
  - –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ TODO/FIXME
  - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TODO –∏–∑ services/payment_gateway.py (–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏)
  - –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π debug –∫–æ–¥

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–í—Å–µ–≥–æ –∑–∞–¥–∞—á**: 10
- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: 1 ‚úÖ
- **–í –ø—Ä–æ—Ü–µ—Å—Å–µ**: 2 ‚ö†Ô∏è
- **–û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**: 2 üîç
- **–ù–µ –Ω–∞—á–∞—Ç–æ**: 5 ‚ùå

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô –ü–û–†–Ø–î–û–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø

1. **–°–Ω–∞—á–∞–ª–∞** (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏):
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å bot_instance –∏–º–ø–æ—Ä—Ç—ã –≤–æ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–ó–∞—Ç–µ–º** (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):
   - Issue 2: Oxapay webhooks (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
   - Issue 3: –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)

3. **–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ**:
   - Issue 4: –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
   - –ü–æ–ª–Ω—ã–π –ª–∏–Ω—Ç–∏–Ω–≥
   - Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

4. **–í –∫–æ–Ω—Ü–µ**:
   - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞
   - –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
