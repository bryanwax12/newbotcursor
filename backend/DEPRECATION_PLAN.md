# –ü–ª–∞–Ω —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏–∑ server.py

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ API —Ñ—É–Ω–∫—Ü–∏–π

**–§—É–Ω–∫—Ü–∏–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:**
1. ‚úÖ `/app/backend/services/api_services.py` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ)
2. ‚ùå `/app/backend/server.py` (—É—Å—Ç–∞—Ä–µ–≤—à–µ–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–π—á–∞—Å)

**–ü—Ä–∏—á–∏–Ω–∞:** –ò–º–ø–æ—Ä—Ç –¥–æ–±–∞–≤–ª–µ–Ω, –Ω–æ –≤—ã–∑–æ–≤—ã –≤—Å—ë –µ—â—ë –∏–¥—É—Ç –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –≤–µ—Ä—Å–∏—è–º.

---

## üìã –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | –°—Ç—Ä–æ–∫–∞ –≤ server.py | –í—ã–∑–æ–≤–æ–≤ | –°—Ç–∞—Ç—É—Å |
|---------|-------------------|---------|--------|
| `create_oxapay_invoice` | 317 | ~5 | ‚è≥ |
| `check_oxapay_payment` | 379 | ~2 | ‚è≥ |
| `check_shipstation_balance` | 451 | ~3 | ‚è≥ |
| `get_shipstation_carrier_ids` | 1820 | ~1 | ‚è≥ |
| `validate_address_with_shipstation` | 1871 | ~2 | ‚è≥ |

**–°—Ç—Ä–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:** ~400

---

## üîÑ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π)

### –®–∞–≥ 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π ‚úÖ
**–°—Ç–∞—Ç—É—Å:** –ú–æ–¥—É–ª—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω, backend —Ä–∞–±–æ—Ç–∞–µ—Ç

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å DEPRECATED –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
–ü–æ–º–µ—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ:
```python
# DEPRECATED: Use services.api_services.create_oxapay_invoice instead
async def create_oxapay_invoice(...):
    ...
```

### –®–∞–≥ 3: –ù–∞–π—Ç–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã (TODO)
```bash
grep -n "await create_oxapay_invoice\|await check_oxapay_payment" server.py
```

### –®–∞–≥ 4: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —è–≤–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
```python
# –ë—ã–ª–æ:
invoice = await create_oxapay_invoice(...)

# –°—Ç–∞–ª–æ:
from services.api_services import create_oxapay_invoice as api_create_invoice
invoice = await api_create_invoice(...)
```

### –®–∞–≥ 5: –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
–ü–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ - —É–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã.

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–æ–ª–Ω–æ–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

## ‚è∞ –ö–æ–≥–¥–∞ –¥–µ–ª–∞—Ç—å

**–ù–ï —Å–µ–π—á–∞—Å** - —Ä–∏—Å–∫ –ø–æ–ª–æ–º–∫–∏ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫.

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:**
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö payment features
- –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ payment_handlers.py
- –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è pytest —Ç–µ—Å—Ç–æ–≤ –¥–ª—è api_services

---

## üéØ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–ª–∏–∞—Å—ã (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
```python
# –í –Ω–∞—á–∞–ª–µ server.py –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–æ–≤
_create_oxapay_invoice = create_oxapay_invoice  # Local version
from services.api_services import create_oxapay_invoice  # Override with imported

# –¢–µ–ø–µ—Ä—å –≤—Å–µ –≤—ã–∑–æ–≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –Ø–≤–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```python
from services.api_services import (
    create_oxapay_invoice as oxapay_create_invoice,
    check_oxapay_payment as oxapay_check_payment,
    # ...
)

# –í –∫–æ–¥–µ –∑–∞–º–µ–Ω–∏—Ç—å:
await create_oxapay_invoice(...) ‚Üí await oxapay_create_invoice(...)
```

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.**

**–ü—Ä–∏—á–∏–Ω—ã:**
1. Backend —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. –î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã (–ø—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ)
3. –†–∏—Å–∫ –ø–æ–ª–æ–º–∫–∏ > –ø–æ–ª—å–∑–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è
4. –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**–°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
- –î–æ–±–∞–≤–∏—Ç—å pytest —Ç–µ—Å—Ç—ã –¥–ª—è api_services.py
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å order_handlers.py (–±–æ–ª—å—à–∏–π impact)
