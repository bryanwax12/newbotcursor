╔══════════════════════════════════════════════════════════════════════════╗
║          🔑 КАК СГЕНЕРИРОВАТЬ И УСТАНОВИТЬ НОВЫЕ КЛЮЧИ                   ║
╚══════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────┐
│                          СПОСОБ 1: АВТОМАТИЧЕСКИЙ                        │
│                            (РЕКОМЕНДУЕТСЯ)                               │
└──────────────────────────────────────────────────────────────────────────┘

Просто запустите скрипт:

    bash /app/update_production_keys.sh

Скрипт автоматически:
  ✅ Сгенерирует все 3 ключа
  ✅ Создаст резервную копию .env
  ✅ Заменит старые ключи на новые
  ✅ Покажет результат
  ✅ Предложит перезапустить backend


┌──────────────────────────────────────────────────────────────────────────┐
│                          СПОСОБ 2: ВРУЧНУЮ                               │
│                      (если хотите контроль)                              │
└──────────────────────────────────────────────────────────────────────────┘

Шаг 1: Сгенерируйте ключи
───────────────────────────────────────────────────────────────────────────

Выполните эту команду:

    openssl rand -hex 32

Скопируйте результат (например: 7a3f9c8e2d1b4a5f6c7d8e9f0a1b2c3d...)

Это будет ваш ADMIN_API_KEY (добавьте префикс sk_admin_):
    
    ADMIN_API_KEY="sk_admin_7a3f9c8e2d1b4a5f6c7d8e9f0a1b2c3d..."


Шаг 2: Сгенерируйте второй ключ
───────────────────────────────────────────────────────────────────────────

Выполните команду:

    openssl rand -base64 32

Скопируйте результат (например: A8B7c6D5e4F3g2H1i0J9k8L7m6N5o4P3q2R1s0==)

Это будет ваш BOT_SIGNATURE_KEY:

    BOT_SIGNATURE_KEY="A8B7c6D5e4F3g2H1i0J9k8L7m6N5o4P3q2R1s0=="


Шаг 3: Сгенерируйте третий ключ
───────────────────────────────────────────────────────────────────────────

Выполните команду:

    echo "production-$(date +%s)"

Скопируйте результат (например: production-1737321600)

Это будет ваш BOT_INSTANCE_ID:

    BOT_INSTANCE_ID="production-1737321600"


Шаг 4: Откройте .env файл
───────────────────────────────────────────────────────────────────────────

    nano /app/backend/.env


Шаг 5: Найдите и замените старые значения
───────────────────────────────────────────────────────────────────────────

Найдите в файле:
    
    ADMIN_API_KEY="sk_admin_e19063c3f82f447ba4ccf49cd97dd9fd_2024"

Замените на ваш новый:

    ADMIN_API_KEY="sk_admin_7a3f9c8e2d1b4a5f6c7d8e9f0a1b2c3d..."

───────────────────────────────────────────────────────────────────────────

Найдите:

    BOT_SIGNATURE_KEY="VMxm-SuinMcpdSRQjEEZG8Mkekhj0pjRh73dzpZDvOM"

Замените на ваш новый:

    BOT_SIGNATURE_KEY="A8B7c6D5e4F3g2H1i0J9k8L7m6N5o4P3q2R1s0=="

───────────────────────────────────────────────────────────────────────────

Найдите:

    BOT_INSTANCE_ID="stale-button-fix"

Замените на ваш новый:

    BOT_INSTANCE_ID="production-1737321600"


Шаг 6: Сохраните файл
───────────────────────────────────────────────────────────────────────────

    Ctrl + O     (сохранить)
    Enter        (подтвердить)
    Ctrl + X     (выйти)


Шаг 7: Перезапустите backend
───────────────────────────────────────────────────────────────────────────

    sudo supervisorctl restart backend


┌──────────────────────────────────────────────────────────────────────────┐
│                     ПРОВЕРКА: ВСЁ ЛИ ПРАВИЛЬНО?                         │
└──────────────────────────────────────────────────────────────────────────┘

Выполните команду для проверки:

    grep -E "ADMIN_API_KEY|BOT_SIGNATURE_KEY|BOT_INSTANCE_ID" /app/backend/.env

Вы должны увидеть ваши НОВЫЕ ключи (не старые!):

    ADMIN_API_KEY="sk_admin_7a3f9c8e..."
    BOT_SIGNATURE_KEY="A8B7c6D5e4..."
    BOT_INSTANCE_ID="production-1737321600"


┌──────────────────────────────────────────────────────────────────────────┐
│                          ЧАСТЫЕ ОШИБКИ                                   │
└──────────────────────────────────────────────────────────────────────────┘

❌ Забыли добавить префикс sk_admin_ для ADMIN_API_KEY
   Правильно: ADMIN_API_KEY="sk_admin_7a3f9c8e..."
   Неправильно: ADMIN_API_KEY="7a3f9c8e..."

❌ Скопировали ключ с лишними пробелами
   Правильно: ADMIN_API_KEY="sk_admin_abc123"
   Неправильно: ADMIN_API_KEY=" sk_admin_abc123 "

❌ Забыли кавычки
   Правильно: ADMIN_API_KEY="sk_admin_abc123"
   Неправильно: ADMIN_API_KEY=sk_admin_abc123

❌ Не перезапустили backend после изменений
   Обязательно: sudo supervisorctl restart backend


┌──────────────────────────────────────────────────────────────────────────┐
│                     БЫСТРАЯ ГЕНЕРАЦИЯ ВСЕХ КЛЮЧЕЙ                        │
└──────────────────────────────────────────────────────────────────────────┘

Скопируйте и выполните эти команды одной строкой:

    echo "ADMIN_API_KEY=\"sk_admin_$(openssl rand -hex 32)\"" && \
    echo "BOT_SIGNATURE_KEY=\"$(openssl rand -base64 32)\"" && \
    echo "BOT_INSTANCE_ID=\"production-$(date +%s)\""

Результат будет выглядеть так:

    ADMIN_API_KEY="sk_admin_497d50ad04c99bb46fff2191707a1efc..."
    BOT_SIGNATURE_KEY="5ebZwq5Rh53Qr3oBbOhVHAffw1nDhNGgInc454Oee0Q="
    BOT_INSTANCE_ID="production-1763584082"

Скопируйте эти 3 строки и вставьте в .env файл!


╔══════════════════════════════════════════════════════════════════════════╗
║                     ⚠️  ВАЖНАЯ БЕЗОПАСНОСТЬ                              ║
╚══════════════════════════════════════════════════════════════════════════╝

  ⚠️  НЕ используйте одни и те же ключи для Test и Production!
  ⚠️  НЕ делитесь ключами ни с кем!
  ⚠️  НЕ коммитьте .env файл в git!
  ⚠️  Сохраните ключи в безопасном месте (password manager)!

╚══════════════════════════════════════════════════════════════════════════╝
